{% load static %}
{% load pwa %}

<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Django CRM</title>
        {% with request.session.theme as theme %}
        <link rel="stylesheet" type="text/css" href="https://bootswatch.com/5/{{ theme|default:'morph' }}/bootstrap.min.css">
        {% endwith %}
        <link rel="stylesheet" type="text/css" href="{% static 'css/styles.css' %}">

        {% progressive_web_app_meta %}
    </head>

    <body>
        <!-- Navbar -->
        {% include 'webapp/navbar.html' %}

        <div class="container">
            <br>
            <!-- Notification messages -->
            {% for message in messages %}
                {% if message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}
                    <div class="message_timer alert alert-success alert-dismissible fade show" role="alert" style="position: relative; padding-bottom: 20px;">
                        <div class="message_content">
                            <i data-feather="check-circle"></i>&nbsp&nbsp {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        <div class="progress" style="height: 10px;">
                            <div class="progress-bar progress-bar-striped bg-success" style="width: 0%;" role="progressbar"></div>
                        </div>
                    </div>
                {% elif message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
                    <div class="message_timer alert alert-danger alert-dismissible fade show" role="alert" style="position: relative; padding-bottom: 20px;">
                        <div class="message_content">
                            <i data-feather="x-circle"></i>&nbsp&nbsp {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        <div class="progress" style="height: 10px;">
                            <div class="progress-bar progress-bar-striped bg-danger" style="width: 0%;" role="progressbar"></div>
                        </div>
                    </div>
                {% elif message.level == DEFAULT_MESSAGE_LEVELS.WARNING %}
                    <div class="message_timer alert alert-warning alert-dismissible fade show" role="alert" style="position: relative; padding-bottom: 20px;">
                        <div class="message_content">
                            <i data-feather="alert-triangle"></i>&nbsp&nbsp {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        <div class="progress" style="height: 10px;">
                            <div class="progress-bar progress-bar-striped bg-warning" style="width: 0%;" role="progressbar"></div>
                        </div>
                    </div>
                {% elif message.level == DEFAULT_MESSAGE_LEVELS.INFO %}
                    <div class="message_timer alert-info alert-dismissible fade show" role="alert" style="position: relative; padding-bottom: 20px;">
                        <div class="message_content">
                            <i data-feather="info"></i>&nbsp&nbsp {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        <div class="progress" style="height: 10px;">
                            <div class="progress-bar progress-bar-striped bg-info" style="width: 0%;" role="progressbar"></div>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}

            
            {% block content %}

            {% endblock %}
    
        </div>

        <script src="{% static 'js/app.js' %}"></script>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>

        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.1.2/css/dataTables.dataTables.min.css"/>
        <script type="text/javascript" src="https://cdn.datatables.net/2.1.2/js/dataTables.min.js"></script>

        <script type="text/javascript" src="https://cdn.datatables.net/buttons/3.1.0/js/dataTables.buttons.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/buttons/3.1.0/js/buttons.dataTables.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/buttons/3.1.0/js/buttons.html5.min.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/buttons/3.1.0/js/buttons.print.min.js"></script>

        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/3.1.0/css/buttons.dataTables.css"/>

        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>

        <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

        <script>
            // Load Feather icons
            feather.replace();

            document.addEventListener('DOMContentLoaded', function() {
            // Select all elements with the class 'message_timer'
            var message_timers = document.querySelectorAll('.message_timer');

            message_timers.forEach(function(message_timer) {
                var progressBar = message_timer.querySelector('.progress-bar');
                var width = 0; // Initial width of the progress bar
                var intervalTime = 50; // Time in ms between each update
                var totalTime = 5000; // Total time in ms to fill the progress bar
                var step = intervalTime / totalTime * 100; // Calculate the step size

                var interval = setInterval(function() {
                    if (width >= 100) {
                        clearInterval(interval); // Clear interval once progress reaches 100%
                        message_timer.style.display = 'none'; // Hide the message timer after progress completes
                    } else {
                        width += step; // Increase the width by the step size
                        progressBar.style.width = width + '%'; // Update the width of the progress bar
                    }
                }, intervalTime);
            });
        });
        </script>
    </body>
</html>